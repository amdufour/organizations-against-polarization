/*! project-name v0.0.1 | (c) 2020 YOUR NAME | MIT License | http://link-to-your-git-repo.com */
const highlightElements=(e,t)=>{let s=getRelatedElements(e);t&&(highlightedNodes=s.relatedNodes),d3.selectAll(".node").classed("faded",t=>t.id!==e&&!s.relatedNodes.includes(t.id)),d3.select(".selected").classed("selected",!1),d3.select(`#node-${e}`).classed("selected",!0),d3.selectAll(".link").classed("highlighted",e=>{const t=`${e.source.id}-to-${e.target.id}`;return!!s.relatedLinks.includes(t)}).classed("hidden",e=>{const t=`${e.source.id}-to-${e.target.id}`;return!s.relatedLinks.includes(t)}),s.tags.length>0&&(d3.select("#action .action-field").text(s.tags.join(", ")),s.tags.length>1?d3.select("#action .conjugate").text("fields"):1==s.tags.length&&d3.select("#action .conjugate").text("field"),d3.select("#action").classed("visible",!0))},unhighlightElements=()=>{d3.selectAll(".node").classed("faded",!1),d3.selectAll(".link").classed("highlighted",!1).classed("hidden",!1),d3.select("#action").classed("visible",!1)},highlightNode=e=>{d3.select(`#node-${e}`).classed("faded",!1)},unHighlightNode=e=>{d3.select(`#node-${e}`).classed("faded",!0)},getNodeParameters=(e,t,s,d)=>{let l={refRadius:0,cx:0,cy:0};switch(!0){case s.includes("node-National"):case s.includes("node-Continental"):l.refRadius=d,l.cx=t.attr("cx"),l.cy=t.attr("cy");break;case s.includes("node-Regional"):l.refRadius=1.5*t.attr("r"),l.cx=t.attr("cx"),l.cy=t.attr("cy");break;case s.includes("node-Global"):case s.includes("node-Bi-National"):const c=e.node().getBBox();l.refRadius=c.width/2,l.cx=c.x+l.refRadius,l.cy=c.y+c.height/2}return l},addBackgroundCircle=(e,t)=>{d3.select(".background-circle").remove();const s=d3.select(`#node-${e}`),d=d3.select(`#node-${e} circle`),l=s.attr("class"),c=getNodeParameters(s,d,l,t);let i=c.refRadius>=30?1.25*c.refRadius:c.refRadius+5;s.insert("circle",":first-child").attr("class","background-circle").attr("r",0).attr("cx",c.cx).attr("cy",c.cy).attr("fill",grey).attr("fill-opacity",.25).attr("stroke","none").style("filter","url(#glow)").transition().duration(50).attr("r",i)},getRelatedElements=e=>{let t={tags:[],relatedNodes:[],relatedLinks:[]};const s=e=>{for(const s of e)t.tags.includes(s)||t.tags.push(s)};return links.forEach(d=>{d.source.id===e?(t.relatedNodes.push(d.target.id),t.relatedLinks.push(`${d.source.id}-to-${d.target.id}`),s(d.tags)):d.target.id===e&&(t.relatedNodes.push(d.source.id),t.relatedLinks.push(`${d.source.id}-to-${d.target.id}`),s(d.tags))}),t};document.addEventListener("click",e=>{const t=e.target.closest("g");!isActiveElement||null!==t&&t.classList.contains("node")||(isActiveElement=!1,d3.select(".background-circle").remove(),highlightedNodes=[],d3.selectAll(".node").classed("faded",!1),d3.selectAll(".link").classed("highlighted",!1).classed("hidden",!1),d3.select("#action").classed("visible",!1),d3.select("#action").classed("visible",!1),d3.select("#info").classed("visible",!0)&&hideInfo())});const showInfo=e=>{d3.event.pageX,d3.event.pageY;const t=getColor(e.type);d3.select("#info .type").text(getGroup(e.type)),d3.select("#info .type").style("color",t.hex),d3.select("#info h3").text(e.label),d3.select("#info .name-background").style("background",t.hex),d3.select("#info .tags").text(e.tags.join(", ")),d3.select("#info .mission-statement").text(e.description),d3.select("#info .mission-container").style("border-left-color",t.hex);const s=""===e.location_of_impact?e.scale:`${e.scale} (${e.location_of_impact})`;d3.select("#info .fact-scale").text(s),d3.select("#info .fact-impact").text(d3.format(",")(e.estimated_people_impacted)),d3.select("#info .fact-url").attr("class",`fact fact-url link-${t.id}`),d3.select("#info .fact-url").attr("href",e.url);let d=e.url.replace("http://","").replace("https://","").replace("www.","");d.endsWith("/")&&(d=d.slice(0,-1)),d3.select("#info .fact-url").text(d),d3.select("#info").classed("visible",!0),window.innerWidth<=768&&d3.select(".notes-section").classed("hidden",!0)},hideInfo=()=>{d3.select("#info").classed("visible",!1),window.innerWidth<=768&&d3.select(".notes-section").classed("hidden",!1)},handleClick=e=>{isActiveElement=!0,highlightElements(e.id,!0),addBackgroundCircle(e.id,getRadius(e.estimated_people_impacted)),window.innerWidth<=768&&showInfo(e)};